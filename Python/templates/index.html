<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
<link rel="stylesheet" href="{{ url_for('static', filename='CSS/style.css') }}">
</head>
    
    
<body>

    <div class="maincontainer">
        <div class="weaponscontainer"></div>
    </div>

    <script type="text/javascript">

        var weaponscontainer = document.getElementsByClassName("weaponscontainer");
        var baseimgpath = "https://www.bungie.net";

        function createView(user){
            for(var i = 0; i < user.characters[2].gear.length; i++){
                if(i < 3){
                    //weapon boxes
                    var perksbox="";
                    var intrinsicbox="";
                    //console.log(baseimgpath + user.characters[0].gear[i].perks[0].displayProperties.icon)
                    for(var j = 0; j < user.characters[2].gear[i].perks.length; j++){
                        if("/img/misc/missing_icon_d2.png" != user.characters[2].gear[i].perks[j].displayProperties.icon){
                            if(j == 0 || j == user.characters[2].gear[i].perks.length-1){
                                intrinsicbox += "<img class=\"itemimg\" src=\""+
                                    baseimgpath + user.characters[2].gear[i].perks[j].displayProperties.icon +
                                    "\">"
                            }else{
                                perksbox += "<img class=\"itemimg\" src=\""+
                                    baseimgpath + user.characters[2].gear[i].perks[j].displayProperties.icon +
                                    "\">"
                            }
                        }
                        
                    }

                    var weaponsdiv =
                    "<div class=\"weaponcontainer\">"+
                        "<div class=\"topitemcontainer\">"+
                            "<img class=\"itemimg\" src=\""+baseimgpath + user.characters[2].gear[i].static.displayProperties.icon+"\">"+

                            "<div class=\"itemtext\">"+
                                "<h1 class=\"itemname\">"+user.characters[2].gear[i].static.displayProperties.name+"</h1>"+
                                "<h2 class=\"itempower\">"+ user.characters[2].gear[i].power+"</h2>"+
                            "</div>"+
                        "</div>"+

                        "<div class=\"itemperkcontainer\">"+
                            perksbox+
                        "</div>"+
                        "<div class=\"itemperkcontainer\">"+
                            intrinsicbox+
                        "</div>"+
                    "</div>";
                    
                    weaponscontainer[0].innerHTML += weaponsdiv;

                    

                }
                
            }
        }






    displayname = window.location.href.split("/")[5]
    var user;
    var xhr = new XMLHttpRequest()
    xhr.open("GET", "http://127.0.0.1:5000/v1/quick/"+displayname, true)
    xhr.onreadystatechange = function(){
        if(this.readyState === 4 && this.status === 200){
            user = JSON.parse(this.responseText);
            console.log(user)
            createView(user);
        }
    }
    xhr.send();
    </script>


    
</body>
</html>